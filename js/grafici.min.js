"use strict";function Grafici(i){this.config=i,this.targetTables=[],this.graphs=[],this.init=function(i){this.targetTables=document.querySelectorAll("."+i.tableClass),this.buildGraphs(this.targetTables)},this.buildGraphs=function(i){for(var t=0;t<i.length;t++){for(var e=i[t].getElementsByTagName("tr"),s=e[0],r={id:t,title:function(){return i[t].getElementsByTagName("caption").length?i[t].getElementsByTagName("caption")[0].textContent:(console.error("Table has no caption, falling back to generic name: "),console.dir(i[t]),"unnamed table")}(),xAxisLabel:s.cells[0].textContent,yAxisLabel:s.cells[1].textContent,xAxis:[],yAxis:[],graphType:this.getGraphType(i[t])},n=1;n<e.length;n++)r.xAxis.push(e[n].cells[0].textContent);for(var h=1;h<e.length;h++)r.yAxis.push(e[h].cells[1].textContent);r.numRows=r.xAxis.length,r.numColumns=r.yAxis.length,r.max=this.getMaxOfArray(r.yAxis),r.min=this.getMinOfArray(r.yAxis),this.graphs.push(r)}this.drawGraphs(this.graphs)},this.getGraphType=function(i){var t=i.getAttribute("class"),e={};return-1!=t.indexOf("grafici-bar-graph")&&(e.barGraph=!0),-1!=t.indexOf("grafici-line-graph")&&(e.lineGraph=!0),e=={}&&(e.lineGraph=!0),e},this.drawGraphs=function(i){for(var t in i){var e=i[t],s=((e.numRows+1)/e.numRows+1)/2;s=(s-1)/2+1;var r=Math.floor(this.config.graphSize.height-this.config.graphSize.height*s),n=Math.floor(this.config.graphSize.height*s*s);this.targetTables[t].style.cssText="opacity:0;position:absolute !important;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);";var h='<figure class="grafici-graph" id="'+this.config.outputID+"-"+e.id+'">',a='<svg class="grafici-graph__svg" viewBox = "0 '+r+" "+this.config.graphSize.width+" "+n+'" version = "1.1">',g='<svg class="grafici-graph__xAxis" viewBox = "0 0 '+this.config.graphSize.width+" "+this.config.graphSize.xAxisHeight+'" version = "1.1">';if(this.config.gridLines){for(var o=r;o<n/this.config.gridLines.size;o++)a+=this.drawLine(0,o*this.config.gridLines.size,this.config.graphSize.width,o*this.config.gridLines.size,this.config.gridLines.stroke,this.config.gridLines.strokeWidth);for(var c=0;c<this.config.graphSize.width/this.config.gridLines.size;c++)a+=this.drawLine(c*this.config.gridLines.size,r,c*this.config.gridLines.size,n,this.config.gridLines.stroke,this.config.gridLines.strokeWidth)}for(var f=0;f<e.numRows;f++){var l=(f+1)/(e.numColumns+1)*this.config.graphSize.width,p=this.config.graphSize.height+(e.yAxis[f]-e.min)/(e.max-e.min)*-this.config.graphSize.height,x=(f+2)/(e.numColumns+1)*this.config.graphSize.width||!1,d=parseInt(this.config.graphSize.height)+(e.yAxis[f+1]-e.min)/(e.max-e.min)*-this.config.graphSize.height;e.graphType.lineGraph&&(f+1<e.numRows&&(a+=this.drawLine(l,p,x,d,this.config.graphLines.stroke,this.config.graphLines.strokeWidth)),a+=this.drawCircle(l,p,this.config.graphPoints.radius)),e.graphType.barGraph&&(a+=this.drawLine(l,n,l,p,this.config.barGraphLines.stroke,this.config.barGraphLines.strokeWidth)),a+=this.drawText(l,p,3,1,"start","black",4,e.yAxis[f],"grafici-data-label"),g+=this.drawText(l,this.config.graphSize.xAxisHeight,0,this.config.graphSize.xAxisHeight/-2,"middle","black",3,e.xAxis[f],"grafici-x-label")}for(var u=0;u<n/(this.config.gridLines.size*this.config.graphSize.yAxisLabelFrequency);u++){var m=3*u*this.config.graphSize.yAxisLabelFrequency,y=(e.max-e.min)/((-n-r)/m)+e.min+(e.max-e.min-r)+r;y=Math.round(100*y)/100,a+=this.drawText(0,m,.5,1,"start","black",3,y,"grafici-y-label")}g+="</svg>",a+="</svg>",h+=a+g+"<figcaption>"+e.title+"</figcaption></figure>",this.targetTables[t].insertAdjacentHTML("afterend",h),document.getElementById(this.config.outputID+"-"+e.id).querySelector(".grafici-graph__svg").style.cssText="border:"+this.config.graphBorder.width+" solid "+this.config.graphBorder.color+";"}},this.drawLine=function(i,t,e,s,r,n){var h='<line x1="'+i+'" y1="'+t+'" x2="'+e+'" y2="'+s+'" stroke="'+r+'" stroke-width = "'+n+'"/>';return h},this.drawText=function(i,t,e,s,r,n,h,a,g){var o='<text class="'+g+'" x="'+i+'" y="'+t+'" dx="'+e+'" dy="'+s+'" text-anchor="'+r+'" fill="'+n+'" font-size="'+h+'">';return o+=a.toString()+"</text>"},this.drawCircle=function(i,t,e){var s='<circle cx="'+i+'" cy="'+t+'" r="'+e+'" fill="'+this.config.graphPoints.color+'" stroke="'+this.config.graphPoints.stroke+'" stroke-width="'+this.config.graphPoints.strokeWidth+'" />';return s},this.getMaxOfArray=function(i){return Math.max.apply(null,i)},this.getMinOfArray=function(i){return Math.min.apply(null,i)},this.init(this.config)}